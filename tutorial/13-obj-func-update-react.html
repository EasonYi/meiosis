<!DOCTYPE html><html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="normalize.css">
<link rel="stylesheet" href="skeleton.css">
<link rel="stylesheet" href="prism.css">
<link rel="stylesheet" href="style.css">
</head>
<body class="container">
<script src="https://flems.io/flems.html" type="text/javascript" charset="utf-8"></script>
<script src="prism.js" type="text/javascript"></script>
<h1>Meiosis Tutorial</h1><p><a href="toc.html">Table of Contents</a></p>
<h2>13 - Object Function Update</h2><p>In the previous lesson, <a href="12-func-update-react.html">12 - Function Update</a>, we looked at a more
flexible way of issuing updates, namely by passing functions to <code>update()</code>.</p>
<p>The majority of the Meiosis examples use this strategy. However, there is a slightly different
way that is even more flexible. We&#39;ll look at it here.</p>
<h3>Putting the function into an object</h3><p>Whereas before, we were passing functions to <code>update()</code>:</p>
<pre><code class="language-js">update(func);
</code></pre>
<p>Now, we&#39;ll put the function in an object. The property to which we associate the function is
<strong>entirely up to you</strong> - here, I&#39;ll use <code>fn</code>:</p>
<pre><code class="language-js">update({ fn: func });
</code></pre>
<p>The only change we need to our Meiosis pattern setup code is to use the <code>fn</code> property to get
the function that performs the update to the model:</p>
<pre><code class="language-js">var models = flyd.scan(function(model, modelUpdate) {
  return modelUpdate.fn(model);
}, app.model(), update);
</code></pre>
<h3>Nesting updates</h3><p>To adjust nesting to these new updates, we just need to get the function from the <code>fn</code> property.
Then, we nest the function as we did before, and put it back on the <code>fn</code> property of the nested
update. We&#39;ll use <code>Object.assign</code> so that we preserve whatever other properties might be on the
issued update:</p>
<pre><code class="language-js">var nestUpdate = function(update, prop) {
  return function(modelUpdate) {
    var fn = modelUpdate.fn;

    update(Object.assign(modelUpdate, {
      fn: function(model) {
        model[prop] = fn(model[prop]);
        return model;
      }
    }));
  };
};
</code></pre>
<p>The rest of the nesting code does not need to change.</p>
<h3>Issuing updates</h3><p>To issue updates, we just need to pass an object with an <code>fn</code> property. So, whereas before we
had:</p>
<pre><code class="language-js">update(function(model) {
  model.value += amount;
  return model;
});
</code></pre>
<p>Now, we&#39;ll use:</p>
<pre><code class="language-js">update({ fn: function(model) {
  model.value += amount;
  return model;
} });
</code></pre>
<h3>Flexibility</h3><p>Issuing updates as objects gives us more flexibility. We can associate other data or metadata
to updates, for parent components to use.</p>
<p>For example:</p>
<ul>
<li>We can simplify <strong>dynamic</strong> lists of components, where we add and remove components at runtime,
by adding a component <code>id</code> to updates. A parent component can use this to identify <em>which</em>
component in the list issued the update.</li>
<li>We can create functionality like <a href="https://reactjs.org/docs/context.html">React Context</a> simply
by having a <code>context</code> property in our model. Then, we can adjust nesting so that <code>context</code> always
remains at the top level. This makes it easy to pass context information (current user, role,
theme, and so on) down component trees. We could update the context by associating the function
to <code>ctx</code> instead of <code>fn</code>, and use it accordingly in the Meiosis setup code.</li>
</ul>
<p>Keep that in mind if you are creating a larger project with Meiosis. You may find that object
updates will be helpful down the line for dealing with complex scenarios.</p>
<p>This concludes the Meiosis tutorial. Thanks for reading, I hope you enjoy Meiosis!</p>
<p><a href="toc.html">Table of Contents</a></p>
<p><a href="http://meiosis.js.org">Meiosis home page</a></p>

</body></html>